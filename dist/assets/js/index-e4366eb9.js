import{d as S,k as C,c as y,S as N,r as U,a as p,o as m,b as h,i as s,f as i,n as r,t as V,m as j,v as L,x as R,e as q,F as A,j as M,T as G,U as f,V as H,W as P,g as W,p as J,q as O}from"./index-9844670a.js";import{d as $}from"./utils-1a885c55.js";import{u as Q}from"./index-07c7c589.js";import{_ as X}from"./_plugin-vue_export-helper-c27b6911.js";const Y=c=>(H("data-v-5f374b93"),c=c(),P(),c),Z={class:"upload-file w-100-p"},x=Y(()=>r("div",{class:"el-upload__text"},[W("将文件拖到这里或"),r("em",null,"点击上传")],-1)),ee={class:"el-upload__tip"},le={class:"file-list"},ae=["href","title"],te={key:1,class:"file-list-item"},se=["href","title"],oe=S({name:"AUploadFile"}),ie=S({...oe,props:{modelValue:{default:()=>({})},valueKey:{default:()=>({label:"name",value:"url",id:"id"})},api:{type:Function,default:void 0},attrs:{default:()=>({multiple:!1,showFileList:void 0,drag:!0,disabled:void 0,limit:1})},size:{default:100},type:{default:void 0},tips:{default:void 0}},emits:["update:modelValue"],setup(c,{emit:_}){const e=c,d=C(J,void 0),v=C(O,void 0),g=y(()=>e.attrs.disabled||(d==null?void 0:d.disabled)),B=y(()=>{var l;return`上传数量限制为：${e.attrs.limit}
上传大小限制为：${e.size}M
上传类型限制为：${((l=e.type)==null?void 0:l.join(","))??"无"}`}),b=y(()=>!e.attrs.multiple&&!!e.modelValue[e.valueKey.value]||e.attrs.multiple&&e.modelValue.length===e.attrs.limit),I=y(()=>N(e.modelValue)?e.modelValue.length>0:!!e.modelValue[e.valueKey.value]),T=U(),z=l=>{var a;const t=l.size/1024/1024<((e==null?void 0:e.size)??0),o=((a=e==null?void 0:e.type)==null?void 0:a.includes(l.type))??!0;return o||f({title:"温馨提示",message:"上传文件不符合所需的格式！",type:"warning"}),t||setTimeout(()=>{f({title:"温馨提示",message:`上传文件大小不能超过 ${(e==null?void 0:e.size)??0}M！`,type:"warning"})},0),b.value&&setTimeout(()=>{f({title:"温馨提示",message:"文件上传失败，已超过最大限制数据，请先删除后再上传！",type:"warning"})},0),o&&t&&!b.value},D=async l=>{let t=new FormData;t.append("file",l.file);try{const o=e.api??Q,{data:a}=await o(t);if(e.attrs.multiple){const n=$(e.modelValue);n.push(a),_("update:modelValue",n)}else _("update:modelValue",a);v!=null&&v.prop&&(d==null||d.validateField([v.prop]))}catch(o){l.onError(o)}},w=l=>{var t;if(!g.value)if(e.attrs.multiple){const o=(t=e.modelValue)==null?void 0:t.findIndex(n=>n[e.valueKey.id]===l[e.valueKey.id]),a=$(e.modelValue);a.splice(o,1),_("update:modelValue",a)}else _("update:modelValue",{})},F=()=>{f({title:"温馨提示",message:"文件上传成功！",type:"success"})},E=()=>{f({title:"温馨提示",message:"文件上传失败，请您重新上传！",type:"error"})};return(l,t)=>{const o=p("upload-filled"),a=p("el-icon"),n=p("el-upload"),K=p("Document"),k=p("CircleClose");return m(),h("div",Z,[s(n,j({ref_key:"uploadRef",ref:T,class:"upload-box",action:"#"},l.attrs,{disabled:g.value,"show-file-list":!1,"http-request":D,"before-upload":z,"on-success":F,"on-error":E}),{default:i(()=>[s(a,{class:"el-icon--upload"},{default:i(()=>[s(o)]),_:1}),x,r("pre",ee,V(l.tips??B.value),1)]),_:1},16,["disabled"]),L(r("ul",le,[l.attrs.multiple?(m(),q(G,{key:0,name:"col"},{default:i(()=>[(m(!0),h(A,null,M(l.modelValue,u=>(m(),h("li",{key:u[l.valueKey.id],class:"file-list-item"},[s(a,null,{default:i(()=>[s(K)]),_:1}),r("a",{class:"item-name sle",href:u[l.valueKey.value],title:u[l.valueKey.label],target:"_blank",download:""},V(u[l.valueKey.label]),9,ae),s(a,{class:"item-remove",onClick:de=>w(u)},{default:i(()=>[s(k)]),_:2},1032,["onClick"])]))),128))]),_:1})):(m(),h("li",te,[s(a,null,{default:i(()=>[s(K)]),_:1}),r("a",{class:"item-name sle",href:`${l.modelValue[l.valueKey.value]}`,title:`${l.modelValue[l.valueKey.label]}`,target:"_blank",download:""},V(`${l.modelValue[l.valueKey.label]}`),9,se),s(a,{class:"item-remove",onClick:t[0]||(t[0]=u=>w(l.modelValue))},{default:i(()=>[s(k)]),_:1})]))],512),[[R,I.value]])])}}});const pe=X(ie,[["__scopeId","data-v-5f374b93"]]);export{pe as default};
