import{u as J}from"./useEnumOption-864bad0c.js";import{d as D,r as i,k as T,c as E,A as Q,w as C,a as v,o as M,b as R,i as u,f as c,g as x,t as A,N as F,R as W,n as q,y as X,p as Y,q as Z,e as ee,s as le,h as te,L as ae}from"./index-9844670a.js";import{_ as oe}from"./_plugin-vue_export-helper-c27b6911.js";const ne={class:"card filter"},de={class:"el-tree-node__label flex-justify-between w-100-p"},se=D({name:"ATreeFilter"}),ue=D({...se,props:{requestApi:{type:Function,default:void 0},data:{default:void 0},title:{default:""},id:{default:"id"},label:{type:[String,Function],default:"label"},multiple:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},isAuth:{type:Boolean,default:!1},defaultExpandAll:{type:Boolean,default:!0},modelValue:{default:void 0}},emits:["update:modelValue"],setup(S,{expose:K,emit:k}){const l=S,O={children:"children",label:l.label},d=i(),y=i([]),_=i([]),p=T(Y,void 0),b=T(Z,void 0),$=E(()=>l.disabled||(p==null?void 0:p.disabled)),{RouterMetaTypeTag:j}=J(),g=i(),w=()=>{l.multiple?g.value=Array.isArray(l.modelValue)?l.modelValue:[l.modelValue]:g.value=typeof l.modelValue=="string"?l.modelValue:""},f=i(l.defaultExpandAll),I=()=>{var t;f.value=!f.value;let e=(t=d==null?void 0:d.value)==null?void 0:t.store.nodesMap;for(let a in e)e[a].expanded=f.value},h=i(!1),L=()=>{var a,n;h.value=!h.value;let e=(a=d==null?void 0:d.value)==null?void 0:a.store.nodesMap;for(let o in e)e[o].checked=h.value;const t=(n=d.value)==null?void 0:n.getCheckedKeys();k("update:modelValue",t)},P=E(()=>$.value?!1:l.multiple);Q(async()=>{var e;if(w(),l.requestApi){const{data:t}=await((e=l.requestApi)==null?void 0:e.call(l));y.value=t,_.value=[{id:"",[typeof l.label=="string"?l.label:"label"]:"全部"},...t]}}),C(()=>l.modelValue,()=>{ae(()=>w())},{deep:!0,immediate:!0}),C(()=>l.data,()=>{var e;(e=l.data)!=null&&e.length&&(y.value=l.data,_.value=[{id:"",[typeof l.label=="string"?l.label:"label"]:"全部"},...l.data])},{deep:!0,immediate:!0});const V=i("");C(V,e=>{var t;(t=d.value)==null||t.filter(e)});const U=(e,t,a)=>{if(!e)return!0;let n=a.parent,o=[a.label],r=1;for(;r<a.level;)o=[...o,n.label],n=n.parent,r++;return o.some(m=>m.indexOf(e)!==-1)},N=()=>{b!=null&&b.prop&&(p==null||p.validateField([b.prop]))},z=e=>{l.multiple||(k("update:modelValue",e[l.id]),N())},B=(e,t=[])=>{var n;const a=t;if(e.length)for(const o of e)a.push(o.name),(n=o.children)!=null&&n.length&&B(o.children,a);return a},G=e=>{var o,r,m;const t=B((e==null?void 0:e.children)??[]),a=(o=d.value)==null?void 0:o.getCheckedKeys();if(a.some(s=>s===e[l.id]))k("update:modelValue",(r=a==null?void 0:a.concat)==null?void 0:r.call(a,t));else{const s=a.filter(H=>!t.includes(H));(m=d.value)==null||m.setCheckedKeys(s),k("update:modelValue",s)}N()};return K({treeData:y,treeAllData:_,treeRef:d}),(e,t)=>{const a=v("el-button"),n=v("el-col"),o=v("el-input"),r=v("el-row"),m=v("el-scrollbar");return M(),R("div",ne,[u(r,{gutter:20},{default:c(()=>[u(n,{span:4,xs:12,sm:12,md:10,lg:8,xl:4},{default:c(()=>[u(a,{type:f.value?"primary":"",onClick:t[0]||(t[0]=s=>I())},{default:c(()=>[x(A(f.value?"收起":"展开"),1)]),_:1},8,["type"]),u(a,{type:h.value?"primary":"",class:"ml10",disabled:!e.multiple,onClick:t[1]||(t[1]=s=>L())},{default:c(()=>[x(A(h.value?"取消全选":"全选"),1)]),_:1},8,["type","disabled"])]),_:1}),u(n,{span:20,xs:12,sm:12,md:14,lg:16,xl:20},{default:c(()=>[u(o,{modelValue:V.value,"onUpdate:modelValue":t[2]||(t[2]=s=>V.value=s),placeholder:"输入关键字进行过滤",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),u(m,null,{default:c(()=>[u(F(W),{ref_key:"treeRef",ref:d,"default-expand-all":f.value,"node-key":e.id,data:e.multiple?y.value:_.value,"show-checkbox":e.multiple,"check-strictly":!0,"current-node-key":e.multiple?"":g.value,"highlight-current":!e.multiple,"expand-on-click-node":!1,"check-on-click-node":P.value,props:O,"filter-node-method":U,"default-checked-keys":e.multiple?g.value:[],onNodeClick:z,onCheck:G},{default:c(s=>[q("span",de,[X(e.$slots,"default",{row:s},()=>[q("span",null,[x(A(s.node.label)+" ",1),e.isAuth?(M(),ee(le(F(j)(s.data.meta.type,"default")),{key:0,class:"ml10"})):te("",!0)])],!0)])]),_:3},8,["default-expand-all","node-key","data","show-checkbox","current-node-key","highlight-current","check-on-click-node","default-checked-keys"])]),_:3})])}}});const pe=oe(ue,[["__scopeId","data-v-ae38e9de"]]);export{pe as default};
