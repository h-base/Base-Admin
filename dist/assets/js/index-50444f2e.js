import{d as D,c as K,a as d,o as u,b as A,i as p,f as s,n as y,t as z,F as L,j as Q,m as w,e as k,_ as W,$ as x,s as oo,h as P,a0 as ao,r as H,w as Y,a1 as lo,y as ro,a2 as so,g as J}from"./index-9844670a.js";import{m as no,d as Z}from"./utils-1a885c55.js";import{m as po}from"./mittBus-4d5f3f5b.js";import{_ as eo}from"./_plugin-vue_export-helper-c27b6911.js";const mo={class:"bold"},uo={class:"pro-form-item-label"},fo={class:"w-100-p text-r border_bottom pb20"},co=D({name:"FormContent"}),io=D({...co,props:{showOperation:{type:Boolean},aAttrsList:{},info:{default:()=>({})},modelValue:{default:()=>({})},rowProp:{default:void 0}},emits:["update:modelValue","onRemoveFormItem","onAddFormItem"],setup(q,{emit:O}){const B=q,m=K({get:()=>B.modelValue,set:e=>{O("update:modelValue",e)}}),j=(e,V)=>{O("onRemoveFormItem",{item:e,index:V})},$=e=>{O("onAddFormItem",{item:e})};return(e,V)=>{const F=d("el-form-item"),T=d("Warning"),M=d("el-icon"),U=d("el-tooltip"),S=d("el-col"),E=d("el-button"),G=d("el-row");return u(),A(L,null,[p(F,{class:"border_bottom"},{label:s(()=>[y("div",mo,z(e.info.formItem.label),1)]),_:1}),p(G,w({class:"border_bottom mb20"},e.rowProp),{default:s(()=>[(u(!0),A(L,null,Q(m.value[e.info.formItem.prop],(h,I)=>(u(),A(L,{key:I},[(u(!0),A(L,null,Q(e.info.formList||[],o=>(u(),k(S,W(w({key:o.formItem.prop},o.col)),{default:s(()=>{var l,f;return[(f=(l=o==null?void 0:o.formItem)==null?void 0:l.hidden)!=null&&f.call(l,m.value,m.value[o.formItem.prop],o)?P("",!0):(u(),k(F,w({key:0},o.formItem,{prop:`${e.info.formItem.prop}.${I}.${o.formItem.prop}`,key:`${e.info.formItem.prop}.${I}.${o.formItem.prop}`}),x({default:s(()=>{var a,r,n;return[o.attrs?(u(),k(oo(o.attrs.typeName==="VNode"?(r=(a=o.attrs).VNode)==null?void 0:r.call(a,m.value[e.info.formItem.prop],m.value,e.info,o):o.attrs.typeName),w({key:`${e.info.formItem.prop}.${I}.${o.formItem.prop}`},o.attrs.typeName==="VNode"?void 0:o.attrs[o.attrs.typeName],{attrs:o.attrs.typeName!=="VNode"&&e.aAttrsList.includes(o.attrs.typeName)?o.attrs[o.attrs.typeName].attrs:void 0,placeholder:e.showOperation?(n=o.attrs[o.attrs.typeName])==null?void 0:n.placeholder:"",modelValue:h[o.formItem.prop],"onUpdate:modelValue":_=>h[o.formItem.prop]=_}),null,16,["attrs","placeholder","modelValue","onUpdate:modelValue"])):P("",!0)]}),_:2},[o.formItem.labelTips?{name:"label",fn:s(({label:a})=>[y("div",uo,[y("span",null,z(a),1),p(U,{content:o.formItem.labelTips,placement:"top"},{default:s(()=>[p(M,{class:"pro-form-item-label__tips",size:16},{default:s(()=>[p(T)]),_:1})]),_:2},1032,["content"])])]),key:"0"}:void 0]),1040,["prop"]))]}),_:2},1040))),128)),p(S,{span:24},{default:s(()=>[p(F,null,{default:s(()=>[y("div",fo,[p(E,{type:"danger",icon:"Minus",onClick:o=>j(e.info,I)},null,8,["onClick"])])]),_:2},1024)]),_:2},1024)],64))),128)),p(S,{span:24},{default:s(()=>[p(F,null,{default:s(()=>[y("div",null,[p(E,{type:"primary",icon:"Plus",onClick:V[0]||(V[0]=h=>$(e.info))})])]),_:1})]),_:1})]),_:1},16)],64)}}});const _o=eo(io,[["__scopeId","data-v-01b1c89d"]]),vo={class:"card content-box"},yo={class:"title-box"},bo={class:"pro-form-item-label"},go={class:"mt20 pt20 w-100-p flex-justify-between form-footer"},Vo={class:"footer-left"},Io={class:"footer-right"},No=D({name:"ProForm"}),ko=D({...No,props:{modelValue:{default:()=>({})},title:{default:""},type:{default:"create"},rowProp:{default:void 0},form:{default:void 0},columns:{default:void 0},info:{default:void 0},http:{default:void 0}},emits:["on-submit","update:modelValue"],setup(q,{expose:O,emit:B}){const m=q,j=ao(),$=H(),e=H({}),V=H(!1),F=["AUploadFile","AUploadImg","AUploadImgs","ASelect","ARadio","ACheckbox","ATreeFilter","ARichEditor","AFormTable","ASelectIcon"],T=K(()=>m.type!=="look"),M=K(()=>m.type==="create"),U=(o,l)=>{var a;const f={};for(const r of o.formList??[])f[r.formItem.prop]=(l==null?void 0:l[r.formItem.prop])??r.formItem.defaultValue;(a=e.value[o.formItem.prop])!=null&&a.length||(e.value[o.formItem.prop]=[]),e.value[o.formItem.prop].push(f)},S=({item:o})=>{var f,a;const l=(f=e.value[o.formItem.prop])==null?void 0:f.reduce((r,n,_)=>{var v;const b=(v=o.formList)==null?void 0:v.map(C=>`${o.formItem.prop}.${_}.${C.formItem.prop}`);return r=r.concat(b??[]),r},[]);(a=$.value)==null||a.validateField(l,r=>{r&&U(o)})},E=({item:o,index:l})=>{e.value[o.formItem.prop].length>1&&e.value[o.formItem.prop].splice(l,1)},G=()=>{var l,f;const o=Z(m.info);for(const a of m.columns)if((l=a.formList)!=null&&l.length){const r=o==null?void 0:o[a.formItem.prop];if(r!=null&&r.length){e.value[a.formItem.prop]=[];for(const n of r)U(a,Z(n))}else U(a)}else if(a.formItem.prop.includes(".")){const r=(f=a.formItem.prop.split("."))==null?void 0:f.reduce((n,_,b,v)=>b===v.length-1?(n==null?void 0:n[_])??a.formItem.defaultValue:(n==null?void 0:n[_])??{},o);e.value[a.formItem.prop]=r}else e.value[a.formItem.prop]=(o==null?void 0:o[a.formItem.prop])??a.formItem.defaultValue},h=()=>{var o;(o=$.value)==null||o.resetFields()},I=async(o=!1)=>await new Promise((l,f)=>{var a;(a=$.value)==null||a.validate(async r=>{var n,_,b,v,C;if(r){const t={};if(Object.keys(e.value).forEach(g=>{if(g.includes(".")){const i=g.split(".");let N={};for(let c=i.length-1;c>=0;c--)N={[i[c]]:c===i.length-1?e.value[g]:N};no(t,N)}else t[g]=e.value[g]}),(n=m.http)!=null&&n.api){V.value=!0;const g=Object.assign({},(_=m.http)==null?void 0:_.params,t);(C=(v=(b=m.http)==null?void 0:b.api)==null?void 0:v.call(b,g))==null||C.then(i=>{var N,c;if(o){po.emit("layout-refresh");const R=document.querySelector(".el-main");R==null||R.scrollTo(0,0)}else(N=m.http)!=null&&N.backRoute?j.push((c=m.http)==null?void 0:c.backRoute):j.back();so.success("提交成功"),l(i)}).catch(i=>{f(i)}).finally(()=>V.value=!1)}else B("on-submit",t),l(t)}})});return Y(()=>m.info,()=>G(),{immediate:!0,deep:!0}),Y(e,o=>{B("update:modelValue",o)},{immediate:!0,deep:!0}),O({element:$,ruleForm:e,handleReset:h,handleSubmit:I}),(o,l)=>{const f=d("Warning"),a=d("el-icon"),r=d("el-tooltip"),n=d("el-form-item"),_=d("el-col"),b=d("el-row"),v=d("el-button"),C=d("el-form");return u(),A("div",vo,[y("h4",yo,z(o.title),1),p(C,w(o.form,{ref_key:"proFormRef",ref:$,model:e.value}),{default:s(()=>[p(b,W(lo(o.rowProp)),{default:s(()=>[(u(!0),A(L,null,Q(o.columns||[],t=>(u(),k(_,W(w({key:t.formItem.prop},t.col)),{default:s(()=>{var g,i,N;return[(g=t.formList)!=null&&g.length?(u(),k(_o,{key:0,modelValue:e.value,"onUpdate:modelValue":l[0]||(l[0]=c=>e.value=c),"row-prop":o.rowProp,showOperation:T.value,aAttrsList:F,info:t,onOnAddFormItem:S,onOnRemoveFormItem:E},null,8,["modelValue","row-prop","showOperation","info"])):(u(),A(L,{key:1},[(N=(i=t==null?void 0:t.formItem)==null?void 0:i.hidden)!=null&&N.call(i,e.value,e.value[t.formItem.prop],t)?P("",!0):(u(),k(n,W(w({key:0},t.formItem)),x({default:s(()=>{var c,R,X;return[t.attrs?(u(),k(oo(t.attrs.typeName==="VNode"?(R=(c=t.attrs).VNode)==null?void 0:R.call(c,e.value[t.formItem.prop],e.value,t):t.attrs.typeName),w({key:0},t.attrs.typeName==="VNode"?void 0:t.attrs[t.attrs.typeName],{attrs:t.attrs.typeName!=="VNode"&&F.includes(t.attrs.typeName)?t.attrs[t.attrs.typeName].attrs:void 0,placeholder:T.value?(X=t.attrs[t.attrs.typeName])==null?void 0:X.placeholder:"",modelValue:e.value[t.formItem.prop],"onUpdate:modelValue":to=>e.value[t.formItem.prop]=to}),null,16,["attrs","placeholder","modelValue","onUpdate:modelValue"])):P("",!0)]}),_:2},[t.formItem.labelTips?{name:"label",fn:s(({label:c})=>[y("div",bo,[y("span",null,z(c),1),p(r,{content:t.formItem.labelTips,placement:"top"},{default:s(()=>[p(a,{class:"pro-form-item-label__tips",size:16},{default:s(()=>[p(f)]),_:1})]),_:2},1032,["content"])])]),key:"0"}:void 0]),1040))],64))]}),_:2},1040))),128))]),_:1},16),ro(o.$slots,"operation",{},()=>[T.value?(u(),k(n,{key:0},{default:s(()=>[y("footer",go,[y("div",Vo,[p(v,{type:"danger",icon:"Refresh",onClick:l[1]||(l[1]=t=>h())},{default:s(()=>[J(" 重置 ")]),_:1})]),y("div",Io,[M.value?(u(),k(v,{key:0,type:"primary",loading:V.value,icon:"Connection",onClick:l[2]||(l[2]=t=>I(!0))},{default:s(()=>[J(" 继续创建 ")]),_:1},8,["loading"])):P("",!0),p(v,{type:"primary",loading:V.value,icon:"Edit",onClick:l[3]||(l[3]=t=>I())},{default:s(()=>[J(" 提交 ")]),_:1},8,["loading"])])])]),_:1})):P("",!0)],!0)]),_:3},16,["model"])])}}});const ho=eo(ko,[["__scopeId","data-v-f62e480f"]]);export{ho as default};
